<!-- templates/products/product_detail.html -->
{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
    <div id="productDetail">
        <!-- Product details will be loaded here -->
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const productId = {{ product_id }};
    const token = localStorage.getItem('token');

    fetch(`/api/product/products/${productId}/`, {
        headers: {
            'Authorization': `Token ${token}`,
            'Content-Type': 'application/json'
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(product => {
        const productDetail = document.getElementById('productDetail');
        console.log(product); // 看看資料結構

        let ingredientsHtml = product.ingredients.map(ingredient => `
            <tr>
                <td>${ingredient.ingredient_name}</td>
                <td>${ingredient.quantity}</td>
            </tr>
        `).join('');

        productDetail.innerHTML = `
            <div class="card">
                <div class="card-header">
                    <h2>${product.title}</h2>
                    <small class="text-muted">Item Number: ${product.item_num}</small>
                </div>
                <div class="card-body">
                    <p><strong>Quantity:</strong> ${product.quantity}</p>
                    <p><strong>Description:</strong> ${product.description}</p>
                </div>
                <table class="table table-striped table-bordered align-middle">
                    <thead class="table-light">
                    <tr>
                        <th scope="col">Ingredient</th>
                        <th scope="col">Quantity</th>
                    </tr>
                    </thead>
                    <tbody>
                    ${ingredientsHtml}
                    </tbody>
                </table>
            </div>
        `;
    })
    .catch(error => {
        console.error('Error fetching product details:', error);
        const productDetail = document.getElementById('productDetail');
        productDetail.innerHTML = `
            <div class="alert alert-danger">
                Error loading product details: ${error.message}
            </div>
        `;
    });
});
</script>
{% endblock %}